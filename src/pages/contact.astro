---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <!-- Large Centered Watermark Logo (Fixed) -->
  <div
    class="fixed inset-0 flex items-center justify-center pointer-events-none z-0 mt-16"
  >
    <img
      src="https://res.cloudinary.com/djrs9oqz7/image/upload/v1767454388/cropped_circle_image_1_npm0nr.png"
      alt="Ram Photo Studio Watermark"
      class="w-[50vw] h-[50vw] md:w-[35vw] md:h-[35vw] lg:w-[30vw] lg:h-[30vw] max-w-xl max-h-xl opacity-[0.10] object-contain"
    />
  </div>

  <!-- Decorative Side Logos -->
  <div
    class="hidden lg:block absolute left-16 top-44 -translate-y-1/2 z-0 pointer-events-none"
  >
    <img
      src="https://res.cloudinary.com/djrs9oqz7/image/upload/v1767454388/cropped_circle_image_1_npm0nr.png"
      alt="Logo"
      class="w-32 h-32 object-contain"
    />
  </div>
  <div
    class="hidden lg:block absolute right-16 top-44 -translate-y-1/2 z-0 pointer-events-none"
  >
    <img
      src="https://res.cloudinary.com/djrs9oqz7/image/upload/v1767454388/cropped_circle_image_1_npm0nr.png"
      alt="Logo"
      class="w-32 h-32 object-contain"
    />
  </div>

  <!-- Content (on top of watermark) -->
  <div class="relative z-10">
    <section class="text-center space-y-3 md:space-y-4">
      <p class="uppercase tracking-[0.3em] text-sm text-[#D97706]">Contact</p>
      <h1 class="text-3xl md:text-4xl font-semibold">Let’s plan your shoot</h1>
      <p class="text-[#5A5246] dark:text-[#CDC3B7] max-w-3xl mx-auto">
        Tell us what you’re looking for—weddings, portraits, products, events,
        or gifts—and we’ll respond quickly with details and availability.
      </p>
    </section>

    <section class="mt-10 grid gap-6 md:grid-cols-2">
      <div
        class="rounded-2xl border border-[#E2D8CB] dark:border-[#3A3630]
        bg-white/80 dark:bg-[#2B2824]
        p-6 space-y-4 shadow-sm"
      >
        <h2 class="text-xl font-semibold">Reach us directly</h2>
        <div class="space-y-3 text-[#5A5246] dark:text-[#CDC3B7]">
          <div>
            <p class="font-semibold">Contact</p>
            <div class="space-y-1 mt-1">
              <a
                href="tel:+915722297297"
                class="block text-[#D97706] dark:text-[#D4A373] hover:underline"
              >
                91-5722-297297
              </a>
              <a
                href="tel:+919412733288"
                class="block text-[#D97706] dark:text-[#D4A373] hover:underline"
              >
                91-9412733288
              </a>
            </div>
          </div>
          <div>
            <p class="font-semibold">Email</p>
            <a
              href="mailto:ramdigitalphotostudio@gmail.com"
              class="text-[#D97706] dark:text-[#D4A373] hover:underline"
            >
              ramdigitalphotostudio@gmail.com
            </a>
          </div>
          <div>
            <p class="font-semibold">Studio</p>
            <p>Ram Photo Studio,</p>
            <p>Near Peeli Kothi,</p>
            <p>Circular Road,</p>
            <p>Hathras: 204101</p>
            <p>Uttar Pradesh</p>
          </div>
          <div>
            <p class="font-semibold">Hours</p>
            <p>Mon–Sat: 9:00 AM – 8:20 PM</p>
            <p>Sunday: By appointment</p>
          </div>
          <div>
            <p class="font-semibold">Social</p>
            <div class="flex gap-4 mt-1">
              <a
                href="https://www.instagram.com/ram_photo_studio204101?igsh=OWp3cWMweWgybDJj"
                target="_blank"
                rel="noopener noreferrer"
                class="hover:scale-125 transition-transform duration-300"
                aria-label="Instagram"
                style="color: #E4405F;"
              >
                <svg
                  class="w-8 h-8"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
                  ></path>
                </svg>
              </a>
              <a
                href="https://www.youtube.com/@ramdigitalphotostudioHathras"
                target="_blank"
                rel="noopener noreferrer"
                class="hover:scale-125 transition-transform duration-300"
                aria-label="YouTube"
                style="color: #FF0000;"
              >
                <svg
                  class="w-8 h-8"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"
                  ></path>
                </svg>
              </a>
              <a
                href="https://www.facebook.com/share/1BkGu124uF/"
                target="_blank"
                rel="noopener noreferrer"
                class="hover:scale-125 transition-transform duration-300"
                aria-label="Facebook"
                style="color: #1877F2;"
              >
                <svg
                  class="w-8 h-8"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
                  ></path>
                </svg>
              </a>
              <a
                href="https://wa.me/919412733288"
                target="_blank"
                rel="noopener noreferrer"
                class="hover:scale-125 transition-transform duration-300"
                aria-label="WhatsApp"
                style="color: #25D366;"
              >
                <svg
                  class="w-8 h-8"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"
                  ></path>
                </svg>
              </a>
            </div>
          </div>
        </div>

        <div class="flex gap-3 pt-2 flex-wrap">
          <a
            href="tel:+915722297297"
            class="inline-flex items-center gap-2 px-5 py-3 rounded-full
          bg-gradient-to-r from-[#20C997] to-[#10A37F] text-white font-semibold
          hover:from-[#10A37F] hover:to-[#0D8F6E]
          hover:scale-105 hover:shadow-[0_8px_20px_rgba(0,0,0,0.25)]
          transition-all duration-300
          shadow-[0_4px_10px_rgba(0,0,0,0.2),inset_0_-2px_5px_rgba(0,0,0,0.2),inset_0_2px_5px_rgba(255,255,255,0.3)]
          hover:translate-y-[-2px]
          active:translate-y-[1px] active:shadow-[0_2px_8px_rgba(0,0,0,0.2),inset_0_2px_5px_rgba(0,0,0,0.3)]"
          >
            Call
          </a>
          <a
            href="mailto:ramdigitalphotostudio@gmail.com"
            class="inline-flex items-center gap-2 px-5 py-3 rounded-full
          bg-gradient-to-r from-[#C9954D] to-[#B8894E] text-white font-semibold
          hover:from-[#D4A056] hover:to-[#C9954D]
          hover:scale-105 hover:shadow-[0_8px_30px_rgba(201,149,77,0.5),0_2px_10px_rgba(0,0,0,0.2)]
          transition-all duration-300
          shadow-[0_4px_15px_rgba(201,149,77,0.4),0_2px_5px_rgba(0,0,0,0.15),inset_0_-2px_5px_rgba(0,0,0,0.2),inset_0_2px_5px_rgba(255,255,255,0.3)]
          hover:translate-y-[-2px]
          active:translate-y-[1px] active:shadow-[0_2px_10px_rgba(201,149,77,0.3),inset_0_2px_5px_rgba(0,0,0,0.3)]"
          >
            Email
          </a>
        </div>
      </div>

      <div
        class="rounded-2xl border border-[#E2D8CB] dark:border-[#3A3630]
        bg-white/90 dark:bg-[#26231F]
        p-6 shadow-sm space-y-4"
      >
        <h2 class="text-xl font-semibold">How can we help you</h2>

        <!-- Success Message -->
        <div
          id="successMessage"
          class="hidden p-4 rounded-lg bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700"
        >
          <p class="text-green-800 dark:text-green-200 font-semibold">
            ✓ Message sent successfully!
          </p>
          <p class="text-green-700 dark:text-green-300 text-sm mt-1">
            We'll get back to you soon via phone.
          </p>
        </div>

        <!-- Success Message with Subscription -->
        <div
          id="successWithSubscribeMessage"
          class="hidden p-4 rounded-lg bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700"
        >
          <p class="text-green-800 dark:text-green-200 font-semibold">
            ✓ Message sent successfully!
          </p>
          <p class="text-green-700 dark:text-green-300 text-sm mt-1">
            We'll get back to you soon via phone.
          </p>
          <p class="text-green-700 dark:text-green-300 text-sm mt-1">
            ✓ Thank you for subscribing! You'll receive updates and special
            offers from us.
          </p>
        </div>

        <!-- Subscribe Section (shown after successful query submission) -->
        <div
          id="subscribeSection"
          class="hidden p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 space-y-3"
        >
          <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100">
            Subscribe to know more about us
          </h3>
          <form id="subscribeForm" class="space-y-3">
            <label class="block">
              <span class="text-sm font-semibold">Email *</span>
              <input
                type="email"
                name="subscribeEmail"
                id="subscribeEmail"
                required
                class="mt-1 w-full rounded-lg border border-[#D9D3CC] dark:border-[#3A3835] bg-white dark:bg-[#26231F] px-3 py-2 outline-none focus:border-[#2563A8] dark:focus:border-[#60A5FA]"
                placeholder="your@email.com"
              />
            </label>
            <div class="flex gap-3">
              <button
                type="submit"
                id="subscribeBtn"
                class="px-5 py-2.5 rounded-full bg-[#2563A8] dark:bg-[#60A5FA] text-white font-semibold hover:translate-y-[-1px] transition shadow disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span id="subscribeBtnText">Subscribe</span>
                <span id="subscribeBtnLoading" class="hidden"
                  >Subscribing...</span
                >
              </button>
              <button
                type="button"
                id="cancelSubscribeBtn"
                class="px-5 py-2.5 rounded-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold hover:bg-gray-100 dark:hover:bg-gray-800 transition"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>

        <!-- Subscribe Success Message -->
        <div
          id="subscribeSuccessMessage"
          class="hidden p-4 rounded-lg bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700"
        >
          <p class="text-green-800 dark:text-green-200 font-semibold">
            ✓ Thank you for subscribing!
          </p>
          <p class="text-green-700 dark:text-green-300 text-sm mt-1">
            You'll receive updates and special offers from us.
          </p>
        </div>

        <!-- Error Message -->
        <div
          id="errorMessage"
          class="hidden p-4 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700"
        >
          <p class="text-red-800 dark:text-red-200 font-semibold">
            ✗ Something went wrong
          </p>
          <p id="errorText" class="text-red-700 dark:text-red-300 text-sm mt-1">
          </p>
        </div>

        <form id="contactForm" class="space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <label class="block">
              <span class="text-sm font-semibold">Name *</span>
              <input
                type="text"
                name="name"
                id="name"
                required
                minlength="2"
                maxlength="30"
                pattern="[A-Za-z\s]+"
                title="Name should contain only letters and spaces (2-30 characters)"
                class="mt-1 w-full rounded-lg border border-[#D9D3CC] dark:border-[#3A3835] bg-transparent px-3 py-2 outline-none focus:border-[#2563A8] dark:focus:border-[#60A5FA]"
                placeholder="Your name"
              />
            </label>
            <label class="block">
              <span class="text-sm font-semibold">Phone *</span>
              <input
                type="tel"
                name="phone"
                id="phone"
                required
                pattern="[0-9]{10}"
                minlength="10"
                maxlength="10"
                title="Please enter exactly 10 digits"
                class="mt-1 w-full rounded-lg border border-[#D9D3CC] dark:border-[#3A3835] bg-transparent px-3 py-2 outline-none focus:border-[#2563A8] dark:focus:border-[#60A5FA]"
                placeholder="10 digit mobile number"
              />
            </label>
          </div>
          <label class="block">
            <span class="text-sm font-semibold">Email (optional)</span>
            <input
              type="email"
              name="email"
              id="email"
              pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
              title="Please enter a valid email address"
              class="mt-1 w-full rounded-lg border border-[#D9D3CC] dark:border-[#3A3835] bg-transparent px-3 py-2 outline-none focus:border-[#2563A8] dark:focus:border-[#60A5FA]"
              placeholder="your@email.com"
            />
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              * Subscribe to receive updates and special offers
            </p>
          </label>
          <label class="block">
            <span class="text-sm font-semibold">Message *</span>
            <textarea
              name="message"
              id="message"
              rows="4"
              required
              class="mt-1 w-full rounded-lg border border-[#D9D3CC] dark:border-[#3A3835] bg-transparent px-3 py-2 outline-none focus:border-[#2563A8] dark:focus:border-[#60A5FA]"
              placeholder="Tell us about your requirements (service type, preferred date, location, etc.)"
            ></textarea>
          </label>
          <button
            type="submit"
            id="submitBtn"
            class="w-full md:w-auto px-5 py-3 rounded-full
          bg-gradient-to-r from-[#20C997] to-[#10A37F] text-white font-semibold
          hover:from-[#10A37F] hover:to-[#0D8F6E]
          hover:scale-105 hover:shadow-[0_8px_20px_rgba(0,0,0,0.25)]
          transition-all duration-300
          shadow-[0_4px_10px_rgba(0,0,0,0.2),inset_0_-2px_5px_rgba(0,0,0,0.2),inset_0_2px_5px_rgba(255,255,255,0.3)]
          hover:translate-y-[-2px]
          active:translate-y-[1px] active:shadow-[0_2px_8px_rgba(0,0,0,0.2),inset_0_2px_5px_rgba(0,0,0,0.3)]
          disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:translate-y-0"
          >
            <span id="btnText">Send message</span>
            <span id="btnLoading" class="hidden">Sending...</span>
          </button>
        </form>
      </div>
    </section>

    <script>
      const form = document.getElementById("contactForm") as HTMLFormElement;
      const submitBtn = document.getElementById(
        "submitBtn",
      ) as HTMLButtonElement;
      const btnText = document.getElementById("btnText") as HTMLSpanElement;
      const btnLoading = document.getElementById(
        "btnLoading",
      ) as HTMLSpanElement;
      const successMessage = document.getElementById(
        "successMessage",
      ) as HTMLDivElement;
      const successWithSubscribeMessage = document.getElementById(
        "successWithSubscribeMessage",
      ) as HTMLDivElement;
      const errorMessage = document.getElementById(
        "errorMessage",
      ) as HTMLDivElement;
      const errorText = document.getElementById(
        "errorText",
      ) as HTMLParagraphElement;

      // Subscribe form elements
      const subscribeSection = document.getElementById(
        "subscribeSection",
      ) as HTMLDivElement;
      const subscribeForm = document.getElementById(
        "subscribeForm",
      ) as HTMLFormElement;
      const subscribeBtn = document.getElementById(
        "subscribeBtn",
      ) as HTMLButtonElement;
      const subscribeBtnText = document.getElementById(
        "subscribeBtnText",
      ) as HTMLSpanElement;
      const subscribeBtnLoading = document.getElementById(
        "subscribeBtnLoading",
      ) as HTMLSpanElement;
      const subscribeSuccessMessage = document.getElementById(
        "subscribeSuccessMessage",
      ) as HTMLDivElement;
      const cancelSubscribeBtn = document.getElementById(
        "cancelSubscribeBtn",
      ) as HTMLButtonElement;

      // Store the enquiry ID for later update
      let currentEnquiryId: number | null = null;

      // Form field validation
      const nameInput = document.getElementById("name") as HTMLInputElement;
      const phoneInput = document.getElementById("phone") as HTMLInputElement;
      const emailInput = document.getElementById("email") as HTMLInputElement;

      // Name validation - only letters and spaces, max 30 chars
      nameInput?.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        // Remove any non-letter/space characters
        target.value = target.value.replace(/[^A-Za-z\s]/g, "");
        // Limit to 30 characters
        if (target.value.length > 30) {
          target.value = target.value.substring(0, 30);
        }
      });

      // Phone validation - only numbers, exactly 10 digits
      phoneInput?.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        // Remove any non-numeric characters
        target.value = target.value.replace(/[^0-9]/g, "");
        // Limit to 10 digits
        if (target.value.length > 10) {
          target.value = target.value.substring(0, 10);
        }
      });

      // Email validation - show error if invalid format
      emailInput?.addEventListener("blur", (e) => {
        const target = e.target as HTMLInputElement;
        if (target.value && !target.validity.valid) {
          target.setCustomValidity("Please enter a valid email address");
        } else {
          target.setCustomValidity("");
        }
      });

      // Handle initial contact form submission
      form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Additional validation before submission
        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();
        const email = emailInput.value.trim();

        // Validate name
        if (name.length < 2 || name.length > 30) {
          errorText.textContent = "Name must be between 2 and 30 characters";
          errorMessage.classList.remove("hidden");
          return;
        }

        if (!/^[A-Za-z\s]+$/.test(name)) {
          errorText.textContent = "Name should contain only letters and spaces";
          errorMessage.classList.remove("hidden");
          return;
        }

        // Validate phone
        if (!/^[0-9]{10}$/.test(phone)) {
          errorText.textContent = "Phone number must be exactly 10 digits";
          errorMessage.classList.remove("hidden");
          return;
        }

        // Validate email if provided
        if (email && !/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i.test(email)) {
          errorText.textContent = "Please enter a valid email address";
          errorMessage.classList.remove("hidden");
          return;
        }

        // Hide previous messages
        successMessage.classList.add("hidden");
        successWithSubscribeMessage.classList.add("hidden");
        errorMessage.classList.add("hidden");
        subscribeSection.classList.add("hidden");
        subscribeSuccessMessage.classList.add("hidden");

        // Show loading state
        submitBtn.disabled = true;
        btnText.classList.add("hidden");
        btnLoading.classList.remove("hidden");

        try {
          // Get form data
          const formData = new FormData(form);
          const email = formData.get("email") as string;

          const enquiryData = {
            name: formData.get("name") as string,
            email: email || undefined,
            phone: formData.get("phone") as string,
            message: formData.get("message") as string,
          };

          // Call API endpoint
          const response = await fetch("/api/submit-enquiry", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(enquiryData),
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || "Failed to submit enquiry");
          }

          // Store the enquiry ID
          currentEnquiryId = result.id;

          // Reset form
          form.reset();

          // Show appropriate success message based on email
          if (email) {
            // User provided email - show combined success message
            successWithSubscribeMessage.classList.remove("hidden");

            // Auto-hide after 3 seconds
            setTimeout(() => {
              successWithSubscribeMessage.classList.add("hidden");
            }, 6000);

            // Scroll to success message
            successWithSubscribeMessage.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
            });
          } else {
            // No email - show basic success and subscribe section
            successMessage.classList.remove("hidden");

            // Auto-hide success message after 3 seconds
            setTimeout(() => {
              successMessage.classList.add("hidden");
            }, 6000);

            // Show subscribe section
            subscribeSection.classList.remove("hidden");

            // Scroll to subscribe section
            subscribeSection.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
            });
          }
        } catch (error: any) {
          // Show error message
          errorText.textContent =
            error.message || "Please try again or contact us directly.";
          errorMessage.classList.remove("hidden");

          // Scroll to error message
          errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
        } finally {
          // Reset button state
          submitBtn.disabled = false;
          btnText.classList.remove("hidden");
          btnLoading.classList.add("hidden");
        }
      });

      // Handle subscribe form submission
      subscribeForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!currentEnquiryId) {
          errorText.textContent = "Please submit your query first.";
          errorMessage.classList.remove("hidden");
          return;
        }

        // Hide previous messages
        errorMessage.classList.add("hidden");

        // Show loading state
        subscribeBtn.disabled = true;
        subscribeBtnText.classList.add("hidden");
        subscribeBtnLoading.classList.remove("hidden");

        try {
          // Get email from subscribe form
          const formData = new FormData(subscribeForm);
          const email = formData.get("subscribeEmail") as string;

          // Call API endpoint
          const response = await fetch("/api/subscribe-email", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: currentEnquiryId,
              email: email,
            }),
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || "Failed to subscribe");
          }

          // Hide subscribe section
          subscribeSection.classList.add("hidden");

          // Show subscribe success message
          subscribeSuccessMessage.classList.remove("hidden");

          // Auto-hide subscribe success message after 3 seconds
          setTimeout(() => {
            subscribeSuccessMessage.classList.add("hidden");
          }, 3000);

          // Reset subscribe form
          subscribeForm.reset();

          // Scroll to success message
          subscribeSuccessMessage.scrollIntoView({
            behavior: "smooth",
            block: "nearest",
          });
        } catch (error: any) {
          // Show error message
          errorText.textContent = error.message || "Please try again later.";
          errorMessage.classList.remove("hidden");

          // Scroll to error message
          errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
        } finally {
          // Reset button state
          subscribeBtn.disabled = false;
          subscribeBtnText.classList.remove("hidden");
          subscribeBtnLoading.classList.add("hidden");
        }
      });

      // Handle cancel button
      cancelSubscribeBtn?.addEventListener("click", () => {
        subscribeSection.classList.add("hidden");
        subscribeForm.reset();
      });
    </script>
  </div>
</BaseLayout>
