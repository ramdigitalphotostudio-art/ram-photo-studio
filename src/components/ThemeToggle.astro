<button
  id="themeToggleBtn"
  class="p-2 border rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition"
>
  <span id="themeIcon">ðŸŒ™</span>
</button>

<script is:inline>
if (!window.__theme_inited) {
  window.__theme_inited = true;
  console.log("ThemeToggle initialized!");

  const root = document.documentElement;

  function applyTheme(saved) {
    if (saved === "dark") {
      root.classList.add("dark");
      document.getElementById("themeIcon").textContent = "ðŸŒž";
    } else {
      root.classList.remove("dark");
      document.getElementById("themeIcon").textContent = "ðŸŒ™";
    }
  }

  // Load saved theme
  applyTheme(localStorage.getItem("theme"));

  // Attach ONE click listener
  document.addEventListener("click", (e) => {
    if (e.target.closest("#themeToggleBtn")) {
      const isDark = root.classList.toggle("dark");
      const newTheme = isDark ? "dark" : "light";
      localStorage.setItem("theme", newTheme);
      applyTheme(newTheme);
    }
  });
}
</script>
